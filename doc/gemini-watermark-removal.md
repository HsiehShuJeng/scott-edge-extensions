# How Gemini Watermark Removal Works

The Watermark Remover feature in Scott's Assistant is a **100% client-side** tool that removes watermarks from images generated by Google Gemini. It uses a technique called **Reverse Alpha Blending**.

## The Algorithm

Images generated by Gemini are watermarked using alpha blending, where a semi-transparent logo is overlaid on the original image. The formula for a watermarked pixel is:

$$ Watermarked = \alpha \times Logo + (1 - \alpha) \times Original $$

Where:
- $\alpha$ is the transparency value of the watermark at that pixel (0 to 1).
- $Logo$ is the color value of the watermark (usually white, 255).
- $Original$ is the original pixel color we want to recover.

### Reverse Alpha Blending

Since we know the `Watermarked` pixel value (from the user's image), the `Logo` value (constant), and the $\alpha$ map (derived from background captures), we can reverse the formula to calculate the `Original` pixel:

$$ Original = \frac{Watermarked - \alpha \times Logo}{1 - \alpha} $$

## Implementation Details

The implementation involves several steps handled by the `WatermarkEngine`:

1.  **Configuration Detection**:
    -   The tool checks the input image dimensions.
    -   If dimensions are > 1024x1024, it assumes a **96x96px** watermark.
    -   Otherwise, it uses a **48x48px** watermark.

2.  **Alpha Map Loading**:
    -   The extension bundles pre-captured background images (`bg_48.png`, `bg_96.png`) which contain the watermark on a known background.
    -   From these reference images, we calculate the precise $\alpha$ map for each pixel in the watermark area.

3.  **Pixel Restoration**:
    -   The tool iterates through the pixels in the bottom-right corner where the watermark is located.
    -   It applies the reverse blending formula to each RGB channel.
    -   To prevent noise and mathematical artifacts, it ignores pixels where $\alpha$ is very close to 0 and clamps the output values to the valid 0-255 range.

## Privacy & Security

-   **No File Uploads**: All processing happens locally in your browser using the HTML5 Canvas API. Your images are never sent to any server.
-   **Performance**: The operation is extremely fast (typically <50ms) as it only processes the small area containing the watermark.

## References

-   This implementation is a port of the [gemini-watermark-remover](https://github.com/journey-ad/gemini-watermark-remover) library.
